<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Multijoueur</title>
  <style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background-color: #f7f7f7;
}

h1 {
  margin-bottom: 10px;
}
#counters {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin: 10px 0;
}
#cards {
  display: grid;
  grid-template-columns: repeat(4, 100px);
  gap: 10px;
  justify-content: center;
  margin: 20px auto;
}

.card {
  width: 100px;
  height: 100px;
  background-color: #3498db;
  color: white;
  font-size: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
}

    .flipped {
      background-color: #2ecc71;
    }

    #status {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>Memory Multijoueur - Joueur <span id="playerNum"></span></h1>
  <div id="counters">
    <div>ðŸŸ¢ Joueur 1 : <span id="score1">0</span> paire(s)</div>
    <div>ðŸ”µ Joueur 2 : <span id="score2">0</span> paire(s)</div>
  </div>
  <div id="cards"></div>
  <div id="status">Chargement...</div>

  <script>
    const channel = new BroadcastChannel("memory_channel");

    let myPlayer = parseInt(prompt("Choisissez votre joueur (1 ou 2)"));
    document.getElementById("playerNum").textContent = myPlayer;

    let currentPlayer = 1;
    let score1 = 0;
    let score2 = 0;
    let flipped = [];
    let isFlipping = false;
    let matchedPairs = 0;
    const totalPairs = 6;

    const status = document.getElementById("status");
    const score1El = document.getElementById("score1");
    const score2El = document.getElementById("score2");
    const cardsContainer = document.getElementById("cards");

    const values = ["A", "B", "C", "D", "E", "F"];
    const cards = shuffle([...values, ...values]);

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function drawBoard() {
      cardsContainer.innerHTML = "";
      cards.forEach((value, index) => {
        const div = document.createElement("div");
        div.className = "card";
        div.dataset.value = value;
        div.dataset.index = index;
        div.addEventListener("click", () => {
          if (myPlayer !== currentPlayer || isFlipping || div.classList.contains("flipped")) return;
          flipCard(div);
        });
        cardsContainer.appendChild(div);
      });
    }

    function flipCard(cardEl) {
      if (cardEl.classList.contains("flipped")) return;

      cardEl.classList.add("flipped");
      cardEl.textContent = cardEl.dataset.value;
      flipped.push(cardEl);

      if (flipped.length === 2) {
        isFlipping = true;

        const [card1, card2] = flipped;
        if (card1.dataset.value === card2.dataset.value) {
          matchedPairs++;
          if (currentPlayer === 1) score1++;
          else score2++;
          updateScores();

          flipped = [];
          isFlipping = false;

          updateStatus(`âœ… Joueur ${currentPlayer} a trouvÃ© une paire et rejoue.`);
          if (matchedPairs === totalPairs) {
            updateStatus(`ðŸ† Joueur ${currentPlayer} a gagnÃ© !`);
          }
        } else {
          updateStatus(`âŒ Pas de paire. Changement de joueur...`);
          setTimeout(() => {
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
            card1.textContent = "";
            card2.textContent = "";
            flipped = [];
            isFlipping = false;

            currentPlayer = currentPlayer === 1 ? 2 : 1;
            channel.postMessage({ type: "change_turn", player: currentPlayer });
            updateStatus(`ðŸ” C'est au joueur ${currentPlayer} de jouer.`);
          }, 1000);
        }
      }
    }

    function updateScores() {
      score1El.textContent = score1;
      score2El.textContent = score2;
    }

    function updateStatus(msg) {
      status.textContent = msg;
    }

    channel.onmessage = (event) => {
      const msg = event.data;
      if (msg.type === "change_turn") {
        currentPlayer = msg.player;
        updateStatus(`ðŸ” C'est au joueur ${currentPlayer} de jouer.`);
      }
    };

    drawBoard();
    setTimeout(() => {
      updateStatus(`ðŸ”„ Le jeu commence. Joueur ${currentPlayer} Ã  vous de jouer !`);
    }, 1000);
  </script>
</body>
</html>